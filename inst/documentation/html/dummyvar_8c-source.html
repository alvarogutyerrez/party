<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>party: dummyvar.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>dummyvar.c</h1><a href="dummyvar_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001                                                                    
00002 <span class="preprocessor">#include &lt;R.h&gt;</span>
00003 <span class="preprocessor">#include &lt;Rmath.h&gt;</span>
00004 <span class="preprocessor">#include &lt;Rdefines.h&gt;</span>
00005 <span class="preprocessor">#include &lt;Rinternals.h&gt;</span>
00006 <span class="preprocessor">#include "<a class="code" href="party_8h.html">party.h</a>"</span>
00007 
<a name="l00008"></a><a class="code" href="dummyvar_8c.html#a0">00008</a> SEXP <a class="code" href="dummyvar_8c.html#a0">dummyvar</a>(SEXP x, SEXP transposed) {
00009 
00010    <span class="keywordtype">int</span> nlevels, n, i, j;
00011    
00012    SEXP ans;
00013    SEXP levels;
00014    SEXP dimnames;
00015    
00016    <span class="keywordflow">if</span> (!isFactor(x)) error(<span class="stringliteral">"x is not a factor\n"</span>);
00017    <span class="keywordflow">if</span> (!isLogical(transposed)) error(<span class="stringliteral">"transposed is not a logical\n"</span>);
00018    
00019    n = LENGTH(x);
00020    levels = GET_LEVELS(x);
00021    nlevels = LENGTH(levels);
00022 
00023    <span class="keywordflow">if</span> (LOGICAL(transposed)[0]) { <span class="comment">/* == TRUE */</span>
00024        PROTECT(ans = allocMatrix(INTSXP, nlevels, n));
00025    
00026        <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00027            <span class="keywordflow">for</span> (j = 0; j &lt; nlevels; j++) {
00028                <span class="keywordflow">if</span> (INTEGER(x)[i] == (j+1)) 
00029                    INTEGER(ans)[<a class="code" href="party_8h.html#a0">aindx</a>(j, i, nlevels)] = 1;
00030                <span class="keywordflow">else</span>
00031                    INTEGER(ans)[<a class="code" href="party_8h.html#a0">aindx</a>(j, i, nlevels)] = 0;
00032            }
00033        }
00034        PROTECT(dimnames = allocVector(VECSXP, 2));
00035        SET_VECTOR_ELT(dimnames, 0, levels);
00036        SET_VECTOR_ELT(dimnames, 1, R_NilValue);
00037        setAttrib(ans, R_DimNamesSymbol, dimnames);
00038    } <span class="keywordflow">else</span> {
00039        PROTECT(ans = allocMatrix(INTSXP, n, nlevels));
00040    
00041        <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00042            <span class="keywordflow">for</span> (j = 0; j &lt; nlevels; j++) {
00043                <span class="keywordflow">if</span> (INTEGER(x)[i] == (j+1)) 
00044                    INTEGER(ans)[<a class="code" href="party_8h.html#a0">aindx</a>(i, j, n)] = 1;
00045                <span class="keywordflow">else</span>
00046                    INTEGER(ans)[<a class="code" href="party_8h.html#a0">aindx</a>(i, j, n)] = 0;
00047            } 
00048        }
00049     
00050        PROTECT(dimnames = allocVector(VECSXP, 2));
00051        SET_VECTOR_ELT(dimnames, 0, R_NilValue);
00052        SET_VECTOR_ELT(dimnames, 1, levels);
00053        setAttrib(ans, R_DimNamesSymbol, dimnames);
00054    }
00055    UNPROTECT(2);
00056    <span class="keywordflow">return</span>(ans);
00057 }
00058 
<a name="l00059"></a><a class="code" href="dummyvar_8c.html#a1">00059</a> SEXP <a class="code" href="dummyvar_8c.html#a1">contcat</a> (SEXP x, SEXP cutpoints) {
00060 
00061     <span class="keywordtype">int</span> i, j, nx, nc;
00062     SEXP ans, rx, rc;
00063     
00064     PROTECT(rx = coerceVector(x, REALSXP));
00065     PROTECT(rc = coerceVector(cutpoints, REALSXP));
00066     
00067     nx = LENGTH(rx);
00068     nc = LENGTH(rc);
00069     
00070     PROTECT(ans = allocMatrix(INTSXP, nc, nx));
00071     
00072     <span class="keywordflow">for</span> (i = 0; i &lt; nx; i++) {
00073         <span class="keywordflow">for</span> (j = 0; j &lt; nc; j++) {
00074             <span class="keywordflow">if</span> (REAL(rx)[i] &lt;= REAL(rc)[j]) {
00075                 INTEGER(ans)[<a class="code" href="party_8h.html#a0">aindx</a>(j, i, nc)] = 1;
00076             } <span class="keywordflow">else</span> {
00077                 INTEGER(ans)[<a class="code" href="party_8h.html#a0">aindx</a>(j, i, nc)] = 0;
00078             }
00079         }
00080     }
00081     
00082     UNPROTECT(3);
00083     <span class="keywordflow">return</span>(ans);
00084 }
00085 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jun 9 14:12:17 2005 for party by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
