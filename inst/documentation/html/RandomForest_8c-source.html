<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>party: RandomForest.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>RandomForest.c</h1><a href="RandomForest_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00009 <span class="preprocessor">#include "<a class="code" href="party_8h.html">party.h</a>"</span>
00010 
00011 
<a name="l00022"></a><a class="code" href="RandomForest_8c.html#a0">00022</a> SEXP <a class="code" href="RandomForest_8c.html#a0">R_Ensemble</a>(SEXP learnsample, SEXP weights, SEXP fitmem, SEXP controls, SEXP ntrees) {
00023             
00024      SEXP nweights, tree, where, ans;
00025      <span class="keywordtype">double</span> *dnweights, *dweights, sw = 0.0, *prob;
00026      <span class="keywordtype">int</span> nobs, i, b, B , nodenum = 1, *iweights, *iwhere;
00027      
00028      B = INTEGER(ntrees)[0];
00029      nobs = <a class="code" href="Classes_8c.html#a90">get_nobs</a>(learnsample);
00030      PROTECT(ans = allocVector(VECSXP, B));
00031 
00032      iweights = Calloc(nobs, <span class="keywordtype">int</span>);
00033      prob = Calloc(nobs, <span class="keywordtype">double</span>);
00034      dweights = REAL(weights);
00035 
00036      <span class="keywordflow">for</span> (i = 0; i &lt; nobs; i++)
00037          sw += dweights[i];
00038      <span class="keywordflow">for</span> (i = 0; i &lt; nobs; i++)
00039          prob[i] = dweights[i]/sw;
00040 
00041      <span class="keywordflow">for</span> (b  = 0; b &lt; B; b++) {
00042          SET_VECTOR_ELT(ans, b, tree = allocVector(VECSXP, <a class="code" href="party_8h.html#a9">NODE_LENGTH</a> + 1));
00043          SET_VECTOR_ELT(tree, <a class="code" href="party_8h.html#a9">NODE_LENGTH</a>, where = allocVector(INTSXP, nobs));
00044          iwhere = INTEGER(where);
00045          <span class="keywordflow">for</span> (i = 0; i &lt; nobs; i++) iwhere[i] = 0;
00046      
00047          <a class="code" href="S3Classes_8c.html#a0">C_init_node</a>(tree, nobs, <a class="code" href="Classes_8c.html#a91">get_ninputs</a>(learnsample), 
00048                      <a class="code" href="Classes_8c.html#a100">get_maxsurrogate</a>(<a class="code" href="Classes_8c.html#a96">get_splitctrl</a>(controls)),
00049                      <a class="code" href="Utils_8c.html#a19">ncol</a>(GET_SLOT(GET_SLOT(learnsample, <a class="code" href="Classes_8c.html#a47">PL2_responsesSym</a>), 
00050                           <a class="code" href="Classes_8c.html#a37">PL2_jointtransfSym</a>)));
00051 
00052          <span class="comment">/* weights for a bootstrap sample */</span>
00053          GetRNGstate();
00054          rmultinom((<span class="keywordtype">int</span>) sw, prob, nobs, iweights);
00055          PutRNGstate();
00056 
00057          nweights = <a class="code" href="S3Classes_8c.html#a3">S3get_nodeweights</a>(tree);
00058          dnweights = REAL(nweights);
00059          <span class="keywordflow">for</span> (i = 0; i &lt; nobs; i++) dnweights[i] = (double) iweights[i];
00060      
00061          <a class="code" href="TreeGrow_8c.html#a0">C_TreeGrow</a>(tree, learnsample, fitmem, controls, iwhere, &amp;nodenum, 1);
00062          nodenum = 1;
00063      }
00064      Free(prob); Free(iweights);
00065      UNPROTECT(1);
00066      <span class="keywordflow">return</span>(ans);
00067 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Apr 4 13:20:29 2006 for party by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
