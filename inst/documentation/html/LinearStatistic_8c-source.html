<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>party: LinearStatistic.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>LinearStatistic.c</h1><a href="LinearStatistic_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00009 <span class="preprocessor">#include "<a class="code" href="party_8h.html">party.h</a>"</span>
00010 
00011 
<a name="l00023"></a><a class="code" href="LinearStatistic_8h.html#a0">00023</a> <span class="keywordtype">void</span> <a class="code" href="LinearStatistic_8c.html#a0">C_LinearStatistic</a> (<span class="keyword">const</span> <span class="keywordtype">double</span> *x, <span class="keyword">const</span> <span class="keywordtype">int</span> p,
00024                         <span class="keyword">const</span> <span class="keywordtype">double</span> *y, <span class="keyword">const</span> <span class="keywordtype">int</span> q,
00025                         <span class="keyword">const</span> <span class="keywordtype">double</span> *weights, <span class="keyword">const</span> <span class="keywordtype">int</span> n,
00026                         <span class="keywordtype">double</span> *ans) {
00027               
00028     <span class="keywordtype">int</span> i, j, k, kp, kn, ip;
00029     <span class="keywordtype">double</span> tmp;
00030 
00031     <span class="keywordflow">for</span> (k = 0; k &lt; q; k++) {
00032 
00033         kn = k * n;
00034         kp = k * p;
00035         <span class="keywordflow">for</span> (j = 0; j &lt; p; j++) ans[kp + j] = 0.0;
00036             
00037         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00038                 
00039             <span class="comment">/* optimization: weights are often zero */</span>
00040             <span class="keywordflow">if</span> (weights[i] == 0.0) <span class="keywordflow">continue</span>;
00041                 
00042             tmp = y[kn + i] * weights[i];
00043                 
00044             ip = i * p;
00045             <span class="keywordflow">for</span> (j = 0; j &lt; p; j++)
00046                  ans[kp + j] += x[j*n + i] * tmp;
00047         }
00048     }
00049 }
00050 
00051 
<a name="l00059"></a><a class="code" href="LinearStatistic_8c.html#a1">00059</a> SEXP <a class="code" href="LinearStatistic_8c.html#a1">R_LinearStatistic</a>(SEXP x, SEXP y, SEXP weights) {
00060 
00061     <span class="comment">/* the return value; a vector of type REALSXP */</span>
00062     SEXP ans;
00063 
00064     <span class="comment">/* dimensions */</span>
00065     <span class="keywordtype">int</span> n, p, q;
00066 
00067     <span class="comment">/* </span>
00068 <span class="comment">     *    only a basic check: we do not coerce objects since this</span>
00069 <span class="comment">     *    function is for internal use only</span>
00070 <span class="comment">     */</span>
00071     
00072     <span class="keywordflow">if</span> (!isReal(x) || !isReal(y) || !isReal(weights))
00073         error(<span class="stringliteral">"LinStat: arguments are not of type REALSXP"</span>);
00074     
00075     n = <a class="code" href="Utils_8c.html#a18">nrow</a>(y);
00076     <span class="keywordflow">if</span> (<a class="code" href="Utils_8c.html#a18">nrow</a>(x) != n || LENGTH(weights) != n)
00077         error(<span class="stringliteral">"LinStat: dimensions don't match"</span>);
00078 
00079     q    = <a class="code" href="Utils_8c.html#a19">ncol</a>(y);
00080     p    = <a class="code" href="Utils_8c.html#a19">ncol</a>(x);
00081            
00082     PROTECT(ans = allocVector(REALSXP, p*q));
00083  
00084     <a class="code" href="LinearStatistic_8c.html#a0">C_LinearStatistic</a>(REAL(x), p, REAL(y), q, REAL(weights), n, 
00085                       REAL(ans));
00086 
00087     UNPROTECT(1);
00088     <span class="keywordflow">return</span>(ans);
00089 }
00090 
00091 
<a name="l00101"></a><a class="code" href="LinearStatistic_8h.html#a1">00101</a> <span class="keywordtype">void</span> <a class="code" href="LinearStatistic_8c.html#a2">C_ExpectCovarInfluence</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>* y, <span class="keyword">const</span> <span class="keywordtype">int</span> q,
00102                             <span class="keyword">const</span> <span class="keywordtype">double</span>* weights, <span class="keyword">const</span> <span class="keywordtype">int</span> n, 
00103                             SEXP ans) {
00104 
00105     <span class="keywordtype">int</span> i, j, k, jq;
00106     
00107     <span class="comment">/* pointers to the slots of object ans */</span>
00108     <span class="keywordtype">double</span> *dExp_y, *dCov_y, *dsweights, tmp;
00109     
00110     <span class="comment">/*  return values: set to zero initially */</span>
00111     dExp_y = REAL(GET_SLOT(ans, <a class="code" href="Classes_8c.html#a0">PL2_expectationSym</a>));
00112     <span class="keywordflow">for</span> (j = 0; j &lt; q; j++) dExp_y[j] = 0.0;
00113     
00114     dCov_y = REAL(GET_SLOT(ans, <a class="code" href="Classes_8c.html#a1">PL2_covarianceSym</a>));
00115     <span class="keywordflow">for</span> (j = 0; j &lt; q*q; j++) dCov_y[j] = 0.0;
00116     
00117     dsweights = REAL(GET_SLOT(ans, <a class="code" href="Classes_8c.html#a5">PL2_sumweightsSym</a>));
00118 
00119     <span class="comment">/*  compute the sum of the weights */</span>
00120         
00121     dsweights[0] = 0;
00122     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) dsweights[0] += weights[i];
00123     <span class="keywordflow">if</span> (dsweights[0] &lt;= 1) 
00124         error(<span class="stringliteral">"C_ExpectCovarInfluence: sum of weights is less than one"</span>);
00125 
00126     <span class="comment">/*</span>
00127 <span class="comment">     *    Expectation of the influence function</span>
00128 <span class="comment">     */</span>
00129 
00130     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00131 
00132         <span class="comment">/*  observations with zero case weights do not contribute */</span>
00133     
00134         <span class="keywordflow">if</span> (weights[i] == 0.0) <span class="keywordflow">continue</span>;
00135     
00136         <span class="keywordflow">for</span> (j = 0; j &lt; q; j++)
00137             dExp_y[j] += weights[i] * y[j * n + i];
00138     }
00139 
00140     <span class="keywordflow">for</span> (j = 0; j &lt; q; j++)
00141         dExp_y[j] = dExp_y[j] / dsweights[0];
00142 
00143 
00144     <span class="comment">/*</span>
00145 <span class="comment">     *    Covariance of the influence function</span>
00146 <span class="comment">     */</span>
00147 
00148     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00149 
00150         <span class="keywordflow">if</span> (weights[i] == 0.0) <span class="keywordflow">continue</span>;
00151      
00152         <span class="keywordflow">for</span> (j = 0; j &lt; q; j++) {
00153             tmp = weights[i] * (y[j * n + i] - dExp_y[j]);
00154             jq = j * q;
00155             <span class="keywordflow">for</span> (k = 0; k &lt; q; k++)
00156                 dCov_y[jq + k] += tmp * (y[k * n + i] - dExp_y[k]);
00157         }
00158     }
00159 
00160     <span class="keywordflow">for</span> (j = 0; j &lt; q*q; j++)
00161         dCov_y[j] = dCov_y[j] / dsweights[0];
00162 }
00163 
00164 
<a name="l00171"></a><a class="code" href="LinearStatistic_8h.html#a4">00171</a> SEXP <a class="code" href="LinearStatistic_8c.html#a3">R_ExpectCovarInfluence</a>(SEXP y, SEXP weights) {
00172 
00173     SEXP ans;
00174     <span class="keywordtype">int</span> q, n;
00175     
00176     <span class="keywordflow">if</span> (!isReal(y) || !isReal(weights))
00177         error(<span class="stringliteral">"R_ExpectCovarInfluence: arguments are not of type REALSXP"</span>);
00178     
00179     n = <a class="code" href="Utils_8c.html#a18">nrow</a>(y);
00180     q = <a class="code" href="Utils_8c.html#a19">ncol</a>(y);
00181     
00182     <span class="keywordflow">if</span> (LENGTH(weights) != n) 
00183         error(<span class="stringliteral">"R_ExpectCovarInfluence: vector of case weights does not have %d elements"</span>, n);
00184 
00185     <span class="comment">/*  allocate storage for return values */</span>
00186     PROTECT(ans = NEW_OBJECT(MAKE_CLASS(<span class="stringliteral">"ExpectCovarInfluence"</span>)));
00187     SET_SLOT(ans, <a class="code" href="Classes_8c.html#a0">PL2_expectationSym</a>, 
00188              PROTECT(allocVector(REALSXP, q)));
00189     SET_SLOT(ans, <a class="code" href="Classes_8c.html#a1">PL2_covarianceSym</a>, 
00190              PROTECT(allocMatrix(REALSXP, q, q)));
00191     SET_SLOT(ans, <a class="code" href="Classes_8c.html#a5">PL2_sumweightsSym</a>, 
00192              PROTECT(allocVector(REALSXP, 1)));
00193 
00194     <a class="code" href="LinearStatistic_8c.html#a2">C_ExpectCovarInfluence</a>(REAL(y), q, REAL(weights), n, ans);
00195     
00196     UNPROTECT(4);
00197     <span class="keywordflow">return</span>(ans);
00198 }
00199 
00200 
<a name="l00213"></a><a class="code" href="LinearStatistic_8h.html#a2">00213</a> <span class="keywordtype">void</span> <a class="code" href="LinearStatistic_8c.html#a4">C_ExpectCovarLinearStatistic</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>* x, <span class="keyword">const</span> <span class="keywordtype">int</span> p, 
00214                                   <span class="keyword">const</span> <span class="keywordtype">double</span>* y, <span class="keyword">const</span> <span class="keywordtype">int</span> q,
00215                                   <span class="keyword">const</span> <span class="keywordtype">double</span>* weights, <span class="keyword">const</span> <span class="keywordtype">int</span> n,
00216                                   <span class="keyword">const</span> SEXP expcovinf, SEXP ans) {
00217 
00218     <span class="keywordtype">int</span> i, j, k, pq, ip;
00219     <span class="keywordtype">double</span> sweights = 0.0, f1, f2, tmp;
00220     <span class="keywordtype">double</span> *swx, *CT1, *CT2, *Covy_x_swx, 
00221            *dExp_y, *dCov_y, *dExp_T, *dCov_T;
00222     
00223     pq   = p * q;
00224     
00225     <span class="comment">/* the expectation and covariance of the influence function */</span>
00226     dExp_y = REAL(GET_SLOT(expcovinf, <a class="code" href="Classes_8c.html#a0">PL2_expectationSym</a>));
00227     dCov_y = REAL(GET_SLOT(expcovinf, <a class="code" href="Classes_8c.html#a1">PL2_covarianceSym</a>));
00228     sweights = REAL(GET_SLOT(expcovinf, <a class="code" href="Classes_8c.html#a5">PL2_sumweightsSym</a>))[0];
00229 
00230     <span class="keywordflow">if</span> (sweights &lt;= 1.0) 
00231         error(<span class="stringliteral">"C_ExpectCovarLinearStatistic: sum of weights is less than one"</span>);
00232 
00233     <span class="comment">/* prepare for storing the results */</span>
00234     dExp_T = REAL(GET_SLOT(ans, <a class="code" href="Classes_8c.html#a0">PL2_expectationSym</a>));
00235     dCov_T = REAL(GET_SLOT(ans, <a class="code" href="Classes_8c.html#a1">PL2_covarianceSym</a>));
00236 
00237     <span class="comment">/* allocate storage: all helpers, initially zero */</span>
00238     swx = Calloc(p, <span class="keywordtype">double</span>);               <span class="comment">/* p x 1  */</span>
00239     CT1 = Calloc(p * p, <span class="keywordtype">double</span>);           <span class="comment">/* p x p  */</span>
00240 
00241     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00242 
00243         <span class="comment">/*  observations with zero case weights do not contribute */</span>
00244         <span class="keywordflow">if</span> (weights[i] == 0.0) <span class="keywordflow">continue</span>;
00245     
00246         ip = i*p;
00247         <span class="keywordflow">for</span> (k = 0; k &lt; p; k++) {
00248             tmp = weights[i] * x[k * n + i];
00249             swx[k] += tmp;
00250 
00251             <span class="comment">/* covariance part */</span>
00252             <span class="keywordflow">for</span> (j = 0; j &lt; p; j++) {
00253                 CT1[j * p + k] += tmp * x[j * n + i];
00254             }
00255         }
00256     }
00257 
00258     <span class="comment">/*</span>
00259 <span class="comment">    *   dExp_T: expectation of the linear statistic T</span>
00260 <span class="comment">    */</span>
00261 
00262     <span class="keywordflow">for</span> (k = 0; k &lt; p; k++) {
00263         <span class="keywordflow">for</span> (j = 0; j &lt; q; j++)
00264             dExp_T[j * p + k] = swx[k] * dExp_y[j];
00265     }
00266 
00267     <span class="comment">/* </span>
00268 <span class="comment">    *   dCov_T:  covariance of the linear statistic T</span>
00269 <span class="comment">    */</span>
00270 
00271     f1 = sweights/(sweights - 1);
00272     f2 = (1/(sweights - 1));
00273 
00274     <span class="keywordflow">if</span> (pq == 1) {
00275         dCov_T[0] = f1 * dCov_y[0] * CT1[0];
00276         dCov_T[0] -= f2 * dCov_y[0] * swx[0] * swx[0];
00277     } <span class="keywordflow">else</span> {
00278         <span class="comment">/* two more helpers needed */</span>
00279         CT2 = Calloc(pq * pq, <span class="keywordtype">double</span>);            <span class="comment">/* pq x pq */</span>
00280         Covy_x_swx = Calloc(pq * q, <span class="keywordtype">double</span>);      <span class="comment">/* pq x q  */</span>
00281         
00282         <a class="code" href="Utils_8c.html#a0">C_kronecker</a>(dCov_y, q, q, CT1, p, p, dCov_T);
00283         <a class="code" href="Utils_8c.html#a0">C_kronecker</a>(dCov_y, q, q, swx, p, 1, Covy_x_swx);
00284         <a class="code" href="Utils_8c.html#a0">C_kronecker</a>(Covy_x_swx, pq, q, swx, 1, p, CT2);
00285 
00286         <span class="keywordflow">for</span> (k = 0; k &lt; (pq * pq); k++)
00287             dCov_T[k] = f1 * dCov_T[k] - f2 * CT2[k];
00288 
00289         <span class="comment">/* clean up */</span>
00290         Free(CT2); Free(Covy_x_swx);
00291     }
00292 
00293     <span class="comment">/* clean up */</span>
00294     Free(swx); Free(CT1); 
00295 }
00296 
00297 
<a name="l00306"></a><a class="code" href="LinearStatistic_8c.html#a5">00306</a> SEXP <a class="code" href="LinearStatistic_8c.html#a5">R_ExpectCovarLinearStatistic</a>(SEXP x, SEXP y, SEXP weights, 
00307                                   SEXP expcovinf) {
00308     
00309     SEXP ans;
00310     <span class="keywordtype">int</span> n, p, q, pq;
00311 
00312     <span class="comment">/* determine the dimensions and some checks */</span>
00313 
00314     n  = <a class="code" href="Utils_8c.html#a18">nrow</a>(x);
00315     p  = <a class="code" href="Utils_8c.html#a19">ncol</a>(x);
00316     q  = <a class="code" href="Utils_8c.html#a19">ncol</a>(y);
00317     pq = p * q;
00318     
00319     <span class="keywordflow">if</span> (<a class="code" href="Utils_8c.html#a18">nrow</a>(y) != n)
00320         error(<span class="stringliteral">"y does not have %d rows"</span>, n);
00321     <span class="keywordflow">if</span> (LENGTH(weights) != n) 
00322         error(<span class="stringliteral">"vector of case weights does not have %d elements"</span>, n);
00323 
00324     PROTECT(ans = NEW_OBJECT(MAKE_CLASS(<span class="stringliteral">"ExpectCovar"</span>)));
00325     SET_SLOT(ans, <a class="code" href="Classes_8c.html#a0">PL2_expectationSym</a>, 
00326              PROTECT(allocVector(REALSXP, pq)));
00327     SET_SLOT(ans, <a class="code" href="Classes_8c.html#a1">PL2_covarianceSym</a>, 
00328              PROTECT(allocMatrix(REALSXP, pq, pq)));
00329 
00330     <a class="code" href="LinearStatistic_8c.html#a4">C_ExpectCovarLinearStatistic</a>(REAL(x), p, REAL(y), q, 
00331         REAL(weights), n, expcovinf, ans);
00332     
00333     UNPROTECT(3);
00334     <span class="keywordflow">return</span>(ans);
00335 }
00336 
00337 
<a name="l00351"></a><a class="code" href="LinearStatistic_8h.html#a3">00351</a> <span class="keywordtype">void</span> <a class="code" href="LinearStatistic_8c.html#a6">C_PermutedLinearStatistic</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> *x, <span class="keyword">const</span> <span class="keywordtype">int</span> p,
00352                                <span class="keyword">const</span> <span class="keywordtype">double</span> *y, <span class="keyword">const</span> <span class="keywordtype">int</span> q,
00353                                <span class="keyword">const</span> <span class="keywordtype">int</span> n, <span class="keyword">const</span> <span class="keywordtype">int</span> nperm,
00354                                <span class="keyword">const</span> <span class="keywordtype">int</span> *indx, <span class="keyword">const</span> <span class="keywordtype">int</span> *perm, 
00355                                <span class="keywordtype">double</span> *ans) {
00356 
00357     <span class="keywordtype">int</span> i, j, k, kp, kn, knpi;
00358 
00359     <span class="keywordflow">for</span> (k = 0; k &lt; q; k++) {
00360 
00361         kn = k * n;
00362         kp = k * p;
00363         <span class="keywordflow">for</span> (j = 0; j &lt; p; j++) ans[kp + j] = 0.0;
00364             
00365         <span class="keywordflow">for</span> (i = 0; i &lt; nperm; i++) {
00366                 
00367             knpi = kn + perm[i];
00368 
00369             <span class="keywordflow">for</span> (j = 0; j &lt; p; j++)
00370                 ans[kp + j] += x[j*n + indx[i]] * y[knpi];
00371         }
00372     }
00373 }
00374 
00375 
<a name="l00384"></a><a class="code" href="LinearStatistic_8c.html#a7">00384</a> SEXP <a class="code" href="LinearStatistic_8c.html#a7">R_PermutedLinearStatistic</a>(SEXP x, SEXP y, SEXP indx, SEXP perm) {
00385 
00386     SEXP ans;
00387     <span class="keywordtype">int</span> n, nperm, p, q, i, *iperm, *iindx;
00388 
00389     <span class="comment">/* </span>
00390 <span class="comment">       only a basic check</span>
00391 <span class="comment">    */</span>
00392 
00393     <span class="keywordflow">if</span> (!isReal(x) || !isReal(y))
00394         error(<span class="stringliteral">"R_PermutedLinearStatistic: arguments are not of type REALSXP"</span>);
00395     
00396     <span class="keywordflow">if</span> (!isInteger(perm))
00397         error(<span class="stringliteral">"R_PermutedLinearStatistic: perm is not of type INTSXP"</span>);
00398     <span class="keywordflow">if</span> (!isInteger(indx))
00399         error(<span class="stringliteral">"R_PermutedLinearStatistic: indx is not of type INTSXP"</span>);
00400     
00401     n = <a class="code" href="Utils_8c.html#a18">nrow</a>(y);
00402     nperm = LENGTH(perm);
00403     iperm = INTEGER(perm);
00404     <span class="keywordflow">if</span> (LENGTH(indx)  != nperm)
00405         error(<span class="stringliteral">"R_PermutedLinearStatistic: dimensions don't match"</span>);
00406     iindx = INTEGER(indx);
00407 
00408     <span class="keywordflow">if</span> (<a class="code" href="Utils_8c.html#a18">nrow</a>(x) != n)
00409         error(<span class="stringliteral">"R_PermutedLinearStatistic: dimensions don't match"</span>);
00410 
00411     <span class="keywordflow">for</span> (i = 0; i &lt; nperm; i++) {
00412         <span class="keywordflow">if</span> (iperm[i] &lt; 0 || iperm[i] &gt; (n - 1) )
00413             error(<span class="stringliteral">"R_PermutedLinearStatistic: perm is not between 1 and nobs"</span>);
00414         <span class="keywordflow">if</span> (iindx[i] &lt; 0 || iindx[i] &gt; (n - 1) )
00415             error(<span class="stringliteral">"R_PermutedLinearStatistic: indx is not between 1 and nobs"</span>);
00416     }
00417 
00418     q    = <a class="code" href="Utils_8c.html#a19">ncol</a>(y);
00419     p    = <a class="code" href="Utils_8c.html#a19">ncol</a>(x);
00420            
00421     PROTECT(ans = allocVector(REALSXP, p*q));
00422     
00423     <a class="code" href="LinearStatistic_8c.html#a6">C_PermutedLinearStatistic</a>(REAL(x), p, REAL(y), q, n, nperm,
00424                  iindx, iperm, REAL(ans));
00425     
00426     UNPROTECT(1);
00427     <span class="keywordflow">return</span>(ans);
00428 }
00429 
00430 
<a name="l00440"></a><a class="code" href="LinearStatistic_8c.html#a8">00440</a> <span class="keywordtype">void</span> <a class="code" href="LinearStatistic_8c.html#a8">C_scmatleft</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> *x, <span class="keyword">const</span> <span class="keywordtype">int</span> p, 
00441                  <span class="keyword">const</span> <span class="keywordtype">int</span> q, <span class="keywordtype">double</span> *ans) {
00442 
00443     <span class="comment">/*</span>
00444 <span class="comment">     *</span>
00445 <span class="comment">     *    The basic difficulty is that the statistic itself is</span>
00446 <span class="comment">     *    L ~ (p, q) but we only look at vec(L)</span>
00447 <span class="comment">     *    </span>
00448 <span class="comment">     *    The function creates a score matrix A in order to</span>
00449 <span class="comment">     *    compute A %*% vec(L) == x %*% L</span>
00450 <span class="comment">     *</span>
00451 <span class="comment">     *    pq is the length of vec(L) (and p is determined from </span>
00452 <span class="comment">     *    the length of x)</span>
00453 <span class="comment">     */</span>
00454     
00455     <span class="keywordtype">int</span> k, j, pq;
00456     
00457     pq = p * q;
00458     <span class="keywordflow">for</span> (j = 0; j &lt; q; j++) {
00459             <span class="keywordflow">for</span> (k = 0; k &lt; p; k++) {
00460                 ans[pq * j + q*k +  j] = x[k];
00461             }
00462     }
00463 }
00464 
00465 
<a name="l00472"></a><a class="code" href="LinearStatistic_8c.html#a9">00472</a> SEXP <a class="code" href="LinearStatistic_8c.html#a9">R_scmatleft</a>(SEXP x, SEXP pq) {
00473 
00474     SEXP ans;
00475     <span class="keywordtype">double</span> *dans, *dx;
00476     <span class="keywordtype">int</span> p, q, i;
00477     
00478     <span class="keywordflow">if</span> (!isReal(x)) error(<span class="stringliteral">"R_scmatleft: x not of type REALSXP"</span>);
00479     <span class="keywordflow">if</span> (!isInteger(pq)) error(<span class="stringliteral">"R_scmatleft: pq not of type INTSXP"</span>);
00480     
00481     dx = REAL(x);
00482     p = LENGTH(x);
00483     q = INTEGER(pq)[0] / p;
00484     
00485     PROTECT(ans = allocMatrix(REALSXP, q, p*q));
00486     dans = REAL(ans);
00487     <span class="keywordflow">for</span> (i = 0; i &lt; q*p*q; i++) dans[i] = 0.0;
00488     
00489     <a class="code" href="LinearStatistic_8c.html#a8">C_scmatleft</a>(dx, p, q, dans);
00490     
00491     UNPROTECT(1);
00492     <span class="keywordflow">return</span>(ans);
00493 }
00494 
00495 
<a name="l00505"></a><a class="code" href="LinearStatistic_8c.html#a10">00505</a> <span class="keywordtype">void</span> <a class="code" href="LinearStatistic_8c.html#a10">C_scmatright</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> *x, <span class="keyword">const</span> <span class="keywordtype">int</span> p, 
00506                  <span class="keyword">const</span> <span class="keywordtype">int</span> q, <span class="keywordtype">double</span> *ans) { 
00507 
00508     <span class="comment">/* </span>
00509 <span class="comment">     *</span>
00510 <span class="comment">     *    The basic difficulty is that the statistic itself is</span>
00511 <span class="comment">     *    L ~ (p, q) but we only look at vec(L)</span>
00512 <span class="comment">     *    </span>
00513 <span class="comment">     *    The function creates a score matrix A in order to</span>
00514 <span class="comment">     *    compute A %*% vec(L) == L %*% x</span>
00515 <span class="comment">     *</span>
00516 <span class="comment">     *    pq is the length of vec(L) (and q is determined from </span>
00517 <span class="comment">     *    the length of x)</span>
00518 <span class="comment">     *</span>
00519 <span class="comment">     */</span> 
00520 
00521     <span class="keywordtype">int</span> i, k, pp;
00522     
00523     pp = p * p;
00524     <span class="keywordflow">for</span> (k = 0; k &lt; q; k++) {
00525         <span class="keywordflow">for</span> (i = 0; i &lt; p; i++) {
00526             ans[pp * k + i * p   + i] = x[k];
00527         }
00528     }
00529 }
00530 
<a name="l00537"></a><a class="code" href="LinearStatistic_8c.html#a11">00537</a> SEXP <a class="code" href="LinearStatistic_8c.html#a11">R_scmatright</a>(SEXP x, SEXP pq) {
00538 
00539     SEXP ans;
00540     <span class="keywordtype">double</span> *dans, *dx;
00541     <span class="keywordtype">int</span> p, q, i;
00542     
00543     <span class="keywordflow">if</span> (!isReal(x)) error(<span class="stringliteral">"R_scmatright: x not of type REALSXP"</span>);
00544     <span class="keywordflow">if</span> (!isInteger(pq)) error(<span class="stringliteral">"R_scmatright: pq not of type INTSXP"</span>);
00545     
00546     dx = REAL(x);
00547     q = LENGTH(x);
00548     p = INTEGER(pq)[0] / q;
00549     
00550     PROTECT(ans = allocMatrix(REALSXP, p, p*q));
00551     dans = REAL(ans);
00552     
00553     <span class="keywordflow">for</span> (i = 0; i &lt; p*p*q; i++) dans[i] = 0.0;
00554     
00555     <a class="code" href="LinearStatistic_8c.html#a10">C_scmatright</a>(dx, p, q, dans);
00556 
00557     UNPROTECT(1);
00558     <span class="keywordflow">return</span>(ans);
00559 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jan 18 11:23:28 2006 for party by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
